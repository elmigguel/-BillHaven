# ONLY USER STEPS - What You Must Do Manually

**Total Time Required:** 45 minutes
**All other work is complete.** These are the ONLY steps that require human action.

---

## STEP 1: Fund Testnet Wallet (5 minutes)

**Why:** Cannot test smart contracts without gas tokens

**Instructions:**
```
1. Visit: https://faucet.polygon.technology/
2. Select network: Polygon Amoy (testnet)
3. Enter wallet address: 0x79fd43109b6096f892706B16f9f750fcaFe5C5d2
4. Request: 1 MATIC (free)
5. Wait: 1-2 minutes for confirmation
```

**Alternative Faucets (if first one doesn't work):**
- https://www.alchemy.com/faucets/polygon-amoy
- https://cloud.google.com/application/web3/faucet/polygon

**Verify Success:**
- Check wallet on https://amoy.polygonscan.com/
- Should see ~1 MATIC balance

---

## STEP 2: Deploy Backend to Railway.app (15 minutes)

**Why:** Webhooks need a live backend server to receive payment notifications

**Instructions:**

### A. Create Railway Account
```
1. Visit: https://railway.app/
2. Click "Start a New Project"
3. Sign up with GitHub (recommended)
```

### B. Deploy from GitHub
```
1. Click "Deploy from GitHub repo"
2. Select: BillHaven repository
3. Set root directory: /server
4. Railway will auto-detect Node.js
```

### C. Add Environment Variables
Click "Variables" tab and add these 8 variables:

```bash
STRIPE_SECRET_KEY=sk_test_***YOUR_STRIPE_SECRET_KEY***

STRIPE_WEBHOOK_SECRET=whsec_b0v3xwHp93Z3Ecgr8Cg8wuHSiZ4fI9Ah

VITE_OPENNODE_API_KEY=e88ab3b3-f11d-44ad-b6c2-fec8fd79a9ae

VITE_SUPABASE_URL=https://bldjdctgjhtucyxqhwpc.supabase.co

VITE_SUPABASE_ANON_KEY=[get from your .env file]

SERVER_URL=[will be auto-generated by Railway]

FRONTEND_URL=https://billhaven-8c40tay2x-mikes-projects-f9ae2848.vercel.app

NODE_ENV=production
```

### D. Deploy
```
1. Click "Deploy"
2. Wait 2-3 minutes for build
3. Copy the generated URL (example: https://billhaven-production.up.railway.app)
4. Update SERVER_URL variable with this URL
5. Redeploy (Railway will auto-restart)
```

### E. Verify Deployment
```
1. Visit: https://your-railway-url.railway.app/health
2. Should see: { "status": "ok", "services": {...} }
3. If error: Check logs in Railway dashboard
```

---

## STEP 3: Configure Stripe Dashboard (10 minutes)

**Why:** Enable European payment methods (iDEAL, SEPA, Bancontact, etc.)

**Instructions:**

### A. Login to Stripe
```
Visit: https://dashboard.stripe.com/test/dashboard
(Use your Stripe account - same one where you got the API keys)
```

### B. Enable Payment Methods
```
1. Click "Settings" (bottom left)
2. Click "Payment methods"
3. Enable these methods:
   âœ… iDEAL (Netherlands)
   âœ… Bancontact (Belgium)
   âœ… SEPA Direct Debit (Europe)
   âœ… SOFORT (Germany/Austria)
   âœ… Klarna (Europe)
   âœ… Google Pay (Worldwide)
   âœ… Cards (already enabled by default)
4. Click "Save" after each
```

### C. Configure Webhook (CRITICAL)
```
1. Click "Developers" â†’ "Webhooks"
2. Click "Add endpoint"
3. Endpoint URL: https://your-railway-url.railway.app/webhooks/stripe
4. Description: BillHaven Payment Webhooks
5. Events to send: Select ALL "checkout.session.*" events:
   - checkout.session.completed
   - checkout.session.expired
   - checkout.session.async_payment_succeeded
   - checkout.session.async_payment_failed
6. Click "Add endpoint"
7. Copy the "Signing secret" (starts with whsec_)
8. Go back to Railway â†’ Variables â†’ Update STRIPE_WEBHOOK_SECRET
9. Railway will auto-restart with new secret
```

---

## STEP 4: Test End-to-End Payment (15 minutes)

**Why:** Verify everything works before real users

**Instructions:**

### Test 1: iDEAL Payment (Safest - No Chargebacks)
```
1. Visit: https://billhaven-8c40tay2x-mikes-projects-f9ae2848.vercel.app
2. Sign up with test email: test@example.com
3. Create a test bill:
   - Amount: â‚¬1.00
   - Blockchain: Polygon Amoy
   - Payment method: iDEAL
4. Complete payment with Stripe test bank
5. Verify webhook received (check Railway logs)
6. Verify hold period enforced (24 hours for NEW_USER)
```

### Test 2: Credit Card with 3D Secure
```
1. Create bill: â‚¬10.00
2. Payment method: Credit Card
3. Use test card: 4000 0027 6000 3184 (requires 3D Secure)
4. Complete 3D Secure challenge
5. Verify 7-day hold period for NEW_USER
```

### Test 3: Lightning Network
```
1. Create bill: â‚¬0.50 (1000 sats)
2. Payment method: Lightning Network
3. Pay with Lightning wallet (or use test QR code scanner)
4. Verify instant confirmation (no hold period)
```

### Test 4: Check Webhook Logs
```
1. Go to Railway dashboard
2. Click "Logs"
3. Should see:
   - "Stripe webhook received"
   - "Payment verified"
   - "Bill updated"
4. If no logs: Check webhook URL is correct in Stripe
```

---

## OPTIONAL NEXT STEPS (Not Required for Launch)

### Week 1: Mainnet Deployment (When Ready for Real Users)
```
1. Fund mainnet deployer wallet:
   - Polygon: Already has 1.0 POL (READY NOW)
   - Other networks: ~$8 total for gas
2. Deploy smart contract V3:
   cd /home/elmigguel/BillHaven
   npx hardhat run scripts/deploy-v3.cjs --network polygon
3. Update contracts.js with mainnet address
4. Redeploy frontend to Vercel
5. Test with small real transaction ($10-50)
```

### Month 1: Additional Networks
```
Fund and deploy to:
- Arbitrum (~$1.50 gas)
- Optimism (~$1.50 gas)
- Base (~$1.50 gas)
- BSC (~$3 gas)
Total: ~$8
```

### Q1 2025: Security & Growth
```
- External security audit (CertiK or OpenZeppelin): $5K-$15K
- Bug bounty program: $50K+ pool
- Marketing campaign
- Scale to 1,000 users
```

---

## TROUBLESHOOTING

### Railway Deployment Failed
**Problem:** Build fails or app crashes
**Solution:**
1. Check logs in Railway dashboard
2. Verify all 8 environment variables are set correctly
3. Ensure STRIPE_WEBHOOK_SECRET starts with "whsec_"
4. Check package.json has "start": "node index.js"

### Stripe Webhook Not Received
**Problem:** Payments complete but backend doesn't update
**Solution:**
1. Check Railway URL is correct in Stripe webhook settings
2. Verify STRIPE_WEBHOOK_SECRET matches Stripe dashboard
3. Test webhook: Stripe dashboard â†’ Webhooks â†’ Send test webhook
4. Check Railway logs for errors

### Testnet Faucet Not Working
**Problem:** Faucet says "rate limited" or "try again later"
**Solution:**
1. Try alternative faucets (Alchemy, Google Cloud)
2. Wait 24 hours (some faucets have daily limits)
3. Ask in Polygon Discord for help
4. Use different wallet address if needed

### Payment Methods Not Showing in Stripe
**Problem:** iDEAL/Bancontact not available
**Solution:**
1. Ensure you're in TEST MODE (not live mode)
2. Some methods require business verification (not needed for test)
3. Try refreshing Stripe dashboard
4. Check your Stripe account country (may affect available methods)

---

## VERIFICATION CHECKLIST

After completing all 4 steps, verify:

- [ ] Testnet wallet has 1+ MATIC on Polygon Amoy
- [ ] Railway backend is deployed and running
- [ ] Railway URL returns { "status": "ok" } at /health endpoint
- [ ] Stripe has 7+ payment methods enabled
- [ ] Stripe webhook is configured with Railway URL
- [ ] Test iDEAL payment completes successfully
- [ ] Test credit card payment completes successfully
- [ ] Test Lightning payment completes successfully
- [ ] Railway logs show webhook received
- [ ] Bills update status after payment

**If all checkboxes are âœ…, you're READY FOR PUBLIC BETA!**

---

## SUPPORT

If you get stuck:

1. **Check Documentation:**
   - DEPLOYMENT_GUIDE.md (detailed walkthrough)
   - API_DOCUMENTATION.md (API reference)
   - TROUBLESHOOTING section above

2. **Check Logs:**
   - Railway: Dashboard â†’ Logs
   - Stripe: Dashboard â†’ Developers â†’ Logs
   - Browser: F12 â†’ Console

3. **Common Issues:**
   - 99% of problems are incorrect environment variables
   - Check for typos in API keys
   - Ensure webhook secrets match exactly

---

**Total Time:** 45 minutes
**Difficulty:** Easy (just copy-paste and configure)
**Result:** PRODUCTION-READY PLATFORM ðŸš€

After these 4 steps, BillHaven is ready for public beta launch!
